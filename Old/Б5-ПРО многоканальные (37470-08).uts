# Поверяемый прибор: Источник питания Б5-3003/3 ПРО
# Поверяемые параметры: (VDC), (IDC), (PVDC), (PIDC), (INSTB_U_Inagr), (INSTB_I_Unagr)
#      
#
# Поверяемые параметры: 
#         погрешность формирования выходного напряжения (VDC) и силы выходного тока (IDC)
#         пульсации выходного напряжения (PVDC) и выходного тока (PIDC)
#         нестабильности при изменении напряжения питающей сети выходного напряжения (INSTB_U_Upit) и тока (INSTB_I_Upit) 
#         нестабильность выходного напряжения при изменении тока нагрузки (INSTB_U_Inagr)
#         нестабильность выходного тока при изменении выходного напряжения (INSTB_I_Unagr)   
#         
#
####################################################################################################################################################### 
###############################################################  S   T   A   R   T   ##################################################################
#######################################################################################################################################################
#
#/ Скрипт для поверки приборов: источники питания MPS-3002L-3, MPS-3003L-3, MPS-3003LK-3, MPS-3005L-3, MPS-3005LK-3
#/<-

#    Выбор поверяемого прибора
call MODE_PRIBOR_CHOICE

#    Выбор нагрузки
call LOAD_CHOISE

#    Выбор типа поверки
call MODE_POVERKA_CHOICE

#    Установка стандартных значений для данного скрипта  (DEFINE)
call START_DEFINE

#    Данные для отчета:
call MODE_INPUT_TABLE

#    Внешний осмотр поверяемого устройства
Call VISUAL_CHECK

#    Опробование устройства
Call OPROBIROVANIE


#####################################################################################################################################################################
##############################################################   D   O   T   S   ####################################################################################
#####################################################################################################################################################################

##################################################################################################################################################################
#/    КАНАЛ 1         
##################################################################################################################################################################

##################################################################################################################################################################
#/    Определение абсолютной погрешности формирования выходного постоянного напряжения.         
##################################################################################################################################################################

#                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    
call VDC_CH1                   1                                0.05                                                  0,9                        0                            1k
call VDC_CH1                   1                                0,1                                                    0,9                        0                            1k    
call VDC_CH1                   1                                0,5                                                    0,9                        0                            1k    
call VDC_CH1                   1                                1                                                       0,9                        0                            1k    


###################################################################################################################################################################
#/    Определение нестабильности выходного напряжения при изменении тока нагрузки.             
###################################################################################################################################################################

#                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Выходной ток от I_max 2, В;
call INSTB_U_Inagr_CH1        1                                1                                  0,9                                         0.8                              300k                                     0

###################################################################################################################################################################
#/    Определение пульсации выходного напряжения.                                                         #uhesh(PVDC_CH1)     
###################################################################################################################################################################

#                            Номер канала;    Напряжение СИ от U_max, В;                                Ток нагрузки от Imax, А;    Интервал жидания, с;
call PVDC_CH1                   1                            1                                                        0.9                            1k
call PVDC_CH1                   1                            1                                                        0                            1k

###################################################################################################################################################################
#/    Определение абсолютной погрешности формирования силы выходного тока.             
###################################################################################################################################################################

#                            Номер канала;    Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;    
call IDC_CH1                       1                            0.05                       0,9                                1,05                        1k
call IDC_CH1                       1                            0,1                        0,9                                1,05                        1k
call IDC_CH1                       1                            0,5                        0,9                                1,05                        1k
call IDC_CH1                       1                            1                          0,9                                1,05                        1k


###################################################################################################################################################################
#/    Определение нестабильности выходного тока при изменении выходного напряжения.            
###################################################################################################################################################################

#                            Номер канала;        Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Выходное напряжение от U_max 2, В;
call INSTB_I_Unagr_CH1             1                            1                        0,9                                1,05                        300k                0,1

###################################################################################################################################################################
#/    Определение пульсации выходного тока.                                                    
###################################################################################################################################################################

#                             Номер канала;                                Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;
call PIDC_CH1                   1                                                            1                                 0,9                                             1.05                            300k


##################################################################################################################################################################
#/    КАНАЛ 2         
##################################################################################################################################################################

##################################################################################################################################################################
#/    Определение абсолютной погрешности формирования выходного постоянного напряжения.         
##################################################################################################################################################################

#                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    
call VDC_CH2                   2                               0.05                                                  0,9                        0                            1k
call VDC_CH2                   2                               0,1                                                    0,9                        0                            1k    
call VDC_CH2                   2                               0,5                                                    0,9                        0                            1k    
call VDC_CH2                   2                               1                                                       0,9                        0                            1k    


###################################################################################################################################################################
#/    Определение нестабильности выходного напряжения при изменении тока нагрузки.             
###################################################################################################################################################################

#                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Выходной ток от I_max 2, В;
call INSTB_U_Inagr_CH2        2                                1                                  0,9                        0.8                              300k                0

###################################################################################################################################################################
#/    Определение пульсации выходного напряжения.                                                         #uhesh(PVDC_CH1)     
###################################################################################################################################################################

#                            Номер канала;    Напряжение СИ от U_max, В;                                Ток нагрузки от Imax, А;    Интервал жидания, с;
call PVDC_CH2                   2                            1                                                        0.8                            1k
call PVDC_CH2                   2                            1                                                        0                            1k

###################################################################################################################################################################
#/    Определение абсолютной погрешности формирования силы выходного тока.             
###################################################################################################################################################################

#                            Номер канала;    Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;    
call IDC_CH2                      2                            0.05                       0,9                                1,05                        1k
call IDC_CH2                      2                            0,1                        0,9                                1,05                        1k
call IDC_CH2                      2                            0,5                        0,9                                1,05                        1k
call IDC_CH2                      2                            1                          0,9                                1,05                        1k


###################################################################################################################################################################
#/    Определение нестабильности выходного тока при изменении выходного напряжения.            
###################################################################################################################################################################

#                            Номер канала;        Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Выходное напряжение от U_max 2, В;
call INSTB_I_Unagr_CH2             2                            1                        0,9                                1,05                        300k                0,1

###################################################################################################################################################################
#/    Определение пульсации выходного тока.                                                    
###################################################################################################################################################################

#                             Номер канала;                                Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;
call PIDC_CH2                   2                                                            1                                 0,9                                             1.05                            300k

##################################################################################################################################################################
#/    КАНАЛ 3         
##################################################################################################################################################################

##################################################################################################################################################################
#/    Определение абсолютной погрешности формирования выходного постоянного напряжения.         
##################################################################################################################################################################

#                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    
call VDC_CH3                   3                                1                                               0,9                        0                            1k


###################################################################################################################################################################
#/    Определение пульсации выходного напряжения.                                                         #uhesh(PVDC_CH1)     
###################################################################################################################################################################

#                            Номер канала;    Напряжение СИ от U_max, В;                                Ток нагрузки от Imax, А;    Интервал жидания, с;
call PVDC_CH3                   3                            1                                                        0.8                            1k
call PVDC_CH3                   3                            1                                                        0                            1k


##################################################################################################################################################################
#/    Параллельное включение        
##################################################################################################################################################################

###################################################################################################################################################################
##/    Определение абсолютной погрешности формирования выходного постоянного напряжения.         
###################################################################################################################################################################
#
##                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    
#call VDC_PAR                   "Параллельное"                    1                                0,9                        0                            1k
#call VDC_PAR                   "Параллельное"                    0,9                                0,9                        0                            1k    
#call VDC_PAR                   "Параллельное"                    0,7                                0,9                        0                            1k    
#call VDC_PAR                   "Параллельное"                    0,5                                0,9                        0                            1k    
#call VDC_PAR                   "Параллельное"                    0,3                                0,9                        0                            1k    
#call VDC_PAR                   "Параллельное"                    0,1                                0,9                        0                            1k    
#
####################################################################################################################################################################
##/    Определение нестабильности выходного напряжения при изменении напряжения питающей сети.
####################################################################################################################################################################
#
##                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Напряжение питания от U_pit, В;    
#call INSTB_U_Upit_PAR       "Параллельное"                    1                                0,9                        0,9                            300k                1,1     
#call INSTB_U_Upit_PAR       "Параллельное"                    1                                0,9                        0,9                            300k                0,9         
#call INSTB_U_Upit_PAR       "Параллельное"                    0,1                                0,9                        0,9                            300k                1,1     
#call INSTB_U_Upit_PAR       "Параллельное"                    0,1                                0,9                        0,9                            300k                0,9         
#
####################################################################################################################################################################
##/    Определение нестабильности выходного напряжения при изменении тока нагрузки.             
####################################################################################################################################################################
#
##                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Выходной ток от I_max 2, В;
#call INSTB_U_Inagr_PAR        "Параллельное"                    1                                  0,9                        1                              300k                0
#
####################################################################################################################################################################
##/    Определение пульсации выходного напряжения.                                                         #uhesh(PVDC_CH1)     
####################################################################################################################################################################
#
##                            Номер канала;    Напряжение СИ от U_max, В;                                Ток нагрузки от Imax, А;    Интервал жидания, с;
#call PVDC_PAR               "Параллельное"                    1                                                        1                            1k
#call PVDC_PAR               "Параллельное"                    1                                                        0                            1k
#
####################################################################################################################################################################
##/    Определение абсолютной погрешности формирования силы выходного тока.             
####################################################################################################################################################################
#
##                            Номер канала;    Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;    
#call IDC_PAR                   "Параллельное"                    1                        0,9                                1,05                        1k
#call IDC_PAR                   "Параллельное"                    0,9                        0,9                                1,05                        1k
#call IDC_PAR                   "Параллельное"                    0,7                        0,9                                1,05                        1k
#call IDC_PAR                   "Параллельное"                    0,5                        0,9                                1,05                        1k
#call IDC_PAR                   "Параллельное"                    0,3                        0,9                                1,05                        1k
#call IDC_PAR                   "Параллельное"                    0,1                        0,9                                1,05                        1k
#
####################################################################################################################################################################
##/ Определение нестабильности выходного тока при изменении напряжения питающей сети.             
####################################################################################################################################################################
#
##                            Номер канала;        Ток СИ от Imax, А;        Напряжение СИ от U_max, В;         Ток нагрузки от Imax, А;    Интервал жидания, с;    Напряжение питания от U_pit, В;
#call INSTB_I_Upit_PAR       "Параллельное"                    1                        0,9                                1,05                        300k                1,1                            
#call INSTB_I_Upit_PAR       "Параллельное"                    1                        0,9                                1,05                        300k                0,9                            
#
####################################################################################################################################################################
##/    Определение нестабильности выходного тока при изменении выходного напряжения.            
####################################################################################################################################################################
#
##                            Номер канала;        Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Выходное напряжение от U_max 2, В;
#call INSTB_I_Unagr_PAR         "Параллельное"                    1                        0,9                                1,05                        300k                0,1
#
###################################################################################################################################################################
##/    Последовательное включение        
###################################################################################################################################################################
#
###################################################################################################################################################################
##/    Определение абсолютной погрешности формирования выходного постоянного напряжения.         
###################################################################################################################################################################
#
##                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    
#call VDC_SER                   "Последовательное"                1                                0,9                        0                            1k
#call VDC_SER                   "Последовательное"                0,9                                0,9                        0                            1k    
#call VDC_SER                   "Последовательное"                0,7                                0,9                        0                            1k    
#call VDC_SER                   "Последовательное"                0,5                                0,9                        0                            1k    
#call VDC_SER                   "Последовательное"                0,3                                0,9                        0                            1k    
#call VDC_SER                   "Последовательное"                0,1                                0,9                        0                            1k    
#
####################################################################################################################################################################
##/    Определение нестабильности выходного напряжения при изменении напряжения питающей сети.
####################################################################################################################################################################
#
##                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Напряжение питания от U_pit, В;    
#call INSTB_U_Upit_SER       "Последовательное"                1                                0,9                        0,9                            300k                1,1     
#call INSTB_U_Upit_SER       "Последовательное"                1                                0,9                        0,9                            300k                0,9         
#call INSTB_U_Upit_SER       "Последовательное"                0,1                                0,9                        0,9                            300k                1,1     
#call INSTB_U_Upit_SER       "Последовательное"                0,1                                0,9                        0,9                            300k                0,9         
#
####################################################################################################################################################################
##/    Определение нестабильности выходного напряжения при изменении тока нагрузки.             
####################################################################################################################################################################
#
##                            Номер канала;    Напряжение СИ от U_max, В;            Ток СИ от Imax, А;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Выходной ток от I_max 2, В;
#call INSTB_U_Inagr_SER        "Последовательное"                1                                  0,9                        1                              300k                0
#
####################################################################################################################################################################
##/    Определение пульсации выходного напряжения.                                                         #uhesh(PVDC_CH1)     
####################################################################################################################################################################
#
##                            Номер канала;    Напряжение СИ от U_max, В;                                Ток нагрузки от Imax, А;    Интервал жидания, с;
#call PVDC_SER               "Последовательное"                1                                                        1                            1k
#call PVDC_SER               "Последовательное"                1                                                        0                            1k
#
####################################################################################################################################################################
##/    Определение абсолютной погрешности формирования силы выходного тока.             
####################################################################################################################################################################
#
##                            Номер канала;    Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;    
#call IDC_SER                   "Последовательное"                1                        0,9                                1,05                        1k
#call IDC_SER                   "Последовательное"                0,9                        0,9                                1,05                        1k
#call IDC_SER                   "Последовательное"                0,7                        0,9                                1,05                        1k
#call IDC_SER                   "Последовательное"                0,5                        0,9                                1,05                        1k
#call IDC_SER                   "Последовательное"                0,3                        0,9                                1,05                        1k
#call IDC_SER                   "Последовательное"                0,1                        0,9                                1,05                        1k
#
####################################################################################################################################################################
##/ Определение нестабильности выходного тока при изменении напряжения питающей сети.             
####################################################################################################################################################################
#
##                            Номер канала;        Ток СИ от Imax, А;        Напряжение СИ от U_max, В;         Ток нагрузки от Imax, А;    Интервал жидания, с;    Напряжение питания от U_pit, В;
#call INSTB_I_Upit_SER       "Последовательное"                1                        0,9                                1,05                        300k                1,1                            
#call INSTB_I_Upit_SER       "Последовательное"                1                        0,9                                1,05                        300k                0,9                            
#
####################################################################################################################################################################
##/    Определение нестабильности выходного тока при изменении выходного напряжения.            
####################################################################################################################################################################
#
##                            Номер канала;        Ток СИ от Imax, А;        Напряжение СИ от U_max, В;        Ток нагрузки от Imax, А;    Интервал жидания, с;    Выходное напряжение от U_max 2, В;
#call INSTB_I_Unagr_SER         "Последовательное"                1                        0,9                                1,05                        300k                0,1

#########################################################################################################################################################################
#########   E   N   D   ###############################################################################################################################
#########################################################################################################################################################################

# Функция сброса всех приборов в изначальное состояние
call RESET_ALL
     if TestResult
          report result "годным"
     else
          report result "не годным"
     endif

EndScript 

#########################################################################################################################################################################
########   F   U   N   C   T   I   O   N   S   ##################################################################################################################################
#########################################################################################################################################################################

# Функция для выбора поверяемого прибора
Function MODE_PRIBOR_CHOICE
message mem_1 selectmenu defvalue=1 "Выберите поверяемый прибор:\nБ5-3003/3" 
    CaseOne
        when mem_1 = 1
            define Model_SI_Report                 Б5-3003-3                #    Модель поверяемого источника питания
            define Interface                    false                    #    Наоличие интерфейса: 0 - нет, 1 - есть
            define CHANEL_NOM                    3                        #    Количество каналов
            ####### Каналы 1 и 2
            define U_max                            30                        #    Максимальное выходное напряжени
            define I_max                             3                        #    Максимальный выходной ток        
            define VDC_coe                        0,005                        #    Коэффициент для расчета допускаемой погрешности, мВ
            define VDC_con                        0,1                    #    Константа для расчета допускаемой погрешности, мВ
            define VDCnagr_coe                    0,002                    #    Коэффициент для расчета допускаемой нестабильности напряжения от Inag, мВ, при нагрузке <=3 A
            define VDCnagr_con                    0,01                        #    Константа для расчета допускаемой нестабильности напряжения от Inag, мВ, при нагрузке <=3 A    
            #define VDCser_nagr_coe               0                        #    Коэффициент для расчета допускаемой нестабильности напряжения от Inag, мВ, при нагрузке <=3 A
            #define VDCser_nagr_con               300m                        #    Константа для расчета допускаемой нестабильности напряжения от Inag, мВ, при нагрузке <=3 A    

            define VDCpuls_coe                    0                        #    Коэффициент для расчета допускаемого уровня пульсаций, мВ
            define VDCpuls_con                    3m                        #    Константа для расчета допускаемого уровня пульсаций, мВ                                    
            define IDC_coe                        0,005                        #    Коэффициент для расчета допускаемой погрешности, мА    
            define IDC_con                        0.01                        #    Константа для расчета допускаемой погрешности, мА
            define IDCnagr_coe                    0.005                        #    Коэффициент для расчета допускаемой нестабильности напряжения от Unag, мА
            define IDCnagr_con                    0.01                        #    Константа для расчета допускаемой нестабильности напряжения от Unag, мА            
            define IDCpuls_coe                    0                        #    Коэффициент для расчета допускаемого уровня пульсаций, мА
            define IDCpuls_con                    5m                        #    Константа для расчета допускаемого уровня пульсаций, мВ
            ####### Канал 3
            define Uch3_max                        5                        #    Максимальное выходное напряжени
            define Ich3_max                        3                        #    Максимальный выходной ток        
            define VDCch3_coe                    0                        #    Коэффициент для расчета допускаемой погрешности, мВ
            define VDCch3_con                   0.05                        #    Константа для расчета допускаемой погрешности, мВ
            define VDCch3_puls_coe                0                        #    Коэффициент для расчета допускаемого уровня пульсаций, мВ
            define VDCch3_puls_con                5m                        #    Константа для расчета допускаемого уровня пульсаций, мВ                                    
    endcase


    define MeasureVDC                        false                            #    Наличие пункта поверки внутреннего вольтметра
    define MeasureIDC                        false                            #    Наличие пункта поверки внутреннего амперметра
    define METODIKA_POVERKI                 ПГПП.436237.010 МП                #    Методика поверки
    define METODIKA_OSMOTR                     6.1                                #    № пункта для "Внешнего осмотра"
    define METODIKA_OPROB                     6.2                                #    № пункта для "Опробования"
    define CHANEL_NOM                        1                                #    Количество каналов
    define U_pit                            220                                #    Номинальное напряжение питания прибора
    define RegNum                            37470-08                        #    Номер в Госреестре
    report METPOV        "METODIKA_POVERKI"
    report Num                        "RegNum"
    math mem_1000 = I_max*2
    math mem_2000 = U_max*2
    report Imax                        "Канал 1(2): I_max; канал 3: Ich3_max; последовательное включение: I_max; параллельное включение: mem_1000"
    report Umax                        "Канал 1(2): U_max; канал 3: Uch3_max; последовательное включение: mem_2000; параллельное включение: U_max"
    report Si                                "Источник питания постоянного тока регулируемый Model_SI_Report"
EndFunction    
    
    


# Функция выбора типа поверки
function MODE_POVERKA_CHOICE
message mem_1 selectmenu defvalue=2 "Выберите тип поверки :\n 1. Первичная \n 2. Периодическая" 
    CaseOne
    when    mem_1 = 1
        report Vid_poverki    "Первичная"
    when    mem_1 = 2 
    report Vid_poverki    "Периодическая"
    endcase
EndFunction

#########################################################################################################################################################################
#######   Вспомогательные функции   #####################################################################################################################################
#########################################################################################################################################################################

#Выбор модели нагрузки
Function LOAD_CHOISE
DriverSet	Keithley7001 OPEN_ALL 									#	разомкнуть все 
    math mem_1000 = I_max
    math mem_2000 = U_max
#	if (mem_1000<=360) and (mem_2000<=60)
#		define LOAD_MODEL						Akip1310				#	Используемая нагрузка(ки)
#		define Load_Max_Curr					360						#	Максимально допустимый ток нагрузки
#		define Load_Max_Volt					60						#	Максимально допустимое напряжение на нагрузке
#		define Load_Max_Power					1,8k					#	Максимальная рассеиваемая мощность
#			if	mem_1000 <= 30															#	Максимальный ток меньше 30
#				DriverSet	Keithley7001 CLOSE = [2;4;7]  							#	замкнуть выходы 2, 4, 7 для установки предела измерений в 30А
#			Else
#				DriverSet	Keithley7001 CLOSE = [3;4;7]  							#	замкнуть выходы 3, 4, 7 для установки предела измерений в 300А
#			Endif
#	else
#		if (mem_1000<=36) and (mem_2000<=300)
#			define LOAD_MODEL					Akip1320				#	Используемая нагрузка(ки)
#			define Load_Max_Curr				36						#	Максимально допустимый ток нагрузки
#			define Load_Max_Volt				300						#	Максимально допустимое напряжение на нагрузке
#			define Load_Max_Power				3,6k					#	Максимальная рассеиваемая мощность
#				if	mem_1000 <= 30
#					DriverSet	Keithley7001 CLOSE = [2;5;6]  							#	замкнуть выходы 2, 5, 6 для установки предела измерений в 30А
#				Else
#					DriverSet	Keithley7001 CLOSE = [3;5;6]  							#	замкнуть выходы 3, 5, 6 для установки предела измерений в 300А
#				Endif
#		else
#			message mem_1 defvalue=1 "Электронная нагрузка не обеспечивает требуемую нагрузку по току и/или напряжению. Выберите используемую нагрузку: \n 1 - АКИП-1310 \n 2 - АКИП-1320 \n 3 - Остановить работу"
			message mem_1 defvalue=1 "Выберите используемую нагрузку: \n 1 - АКИП-1310 \n 2 - АКИП-1320 \n 3 - Остановить работу"
			if mem_1 = 1
				define LOAD_MODEL				Akip1310				#	Используемая нагрузка(ки)
				define Load_Max_Curr			360						#	Максимально допустимый ток нагрузки
				define Load_Max_Volt			60						#	Максимально допустимое напряжение на нагрузке
				define Load_Max_Power			1,8k					#	Максимальная рассеиваемая мощность
				if	mem_1000 <= 30															#	Максимальный ток меньше 30
					DriverSet	Keithley7001 CLOSE = [2;4;7]  							#	замкнуть выходы 2, 4, 7 для установки предела измерений в 30А
				Else
					DriverSet	Keithley7001 CLOSE = [3;4;7]  							#	замкнуть выходы 3, 4, 7 для установки предела измерений в 300А
				Endif
			endif
			
			if mem_1 = 2
				define LOAD_MODEL				Akip1320				#	Используемая нагрузка(ки)
				define Load_Max_Curr			36						#	Максимально допустимый ток нагрузки
				define Load_Max_Volt			300						#	Максимально допустимое напряжение на нагрузке
				define Load_Max_Power			3,6k					#	Максимальная рассеиваемая мощность
				if	mem_1000 <= 30
					DriverSet	Keithley7001 CLOSE = [2;5;6]  							#	замкнуть выходы 2, 5, 6 для установки предела измерений в 30А
				Else
					DriverSet	Keithley7001 CLOSE = [3;5;6]  							#	замкнуть выходы 3, 5, 6 для установки предела измерений в 300А
				Endif
			endif
			
			if mem_1 = 3
			endscript													#	Остановить скрипт
			endif
		#endif
		
	#endif
	DriverSet	LOAD_MODEL 			RESET
EndFunction

# Функция для установки входных данных
Function START_DEFINE
    define VOLTAGE_METER                Keithley2002            #    Эталон для измерения напряжения
    define CURRENT_METER                Instek71000                #    Эталон для измерения силы тока
    define PULS_METER                    Akip2402                #    Эталон для измерения пульсаций
    message "На вольтметре АКИП-2402 нажмите кнопку 'Rem' для измерения уровня пульсаций" 
    define POWER_SUPPLY                    Akip1202                #    Эталонный источник питания (Латер)
EndFunction

#Внесение данных условий поверки
function MODE_INPUT_TABLE
# Создание таблицы для условий поверки
    table clear                                                                                     # очистка настройки наблицы 
    table row "Температура окружающего воздуха, С" checksyntax defvalue=20,0
    table row "Атмосферное давление, кПа" checksyntax defvalue=98,5
    table row "Относительная влажность окружающего воздуха, %" checksyntax defvalue=45
    table show mem_1000                                                                              # вывести меню
# Перенос значений из массива в переменные
    math mem_1001 = mem_1000[1]
    math mem_1002 = mem_1000[2]
    math mem_1003 = mem_1000[3]
# Занесение данных в протокол WORD
    report TEMP            mem_1001
    report PRESS        mem_1002
    report HUM            mem_1003
EndFunction

# Внешний осмотр поверяемого устройства
function VISUAL_CHECK
    message mem_1005 selectmenu_str defvalue="Соответствует" "Внешний осмотр\n Соответствует \n Не соответствует"
    if mem_1005="Соответствует"
        report VISUAL_CHECK "Соответствует"
    else
        report VISUAL_CHECK "Не соответствует"
        report result "не годным"
        Endscript
    endif
EndFunction

#Опробование прибора
function OPROBIROVANIE
    message mem_1006 selectmenu_str defvalue="Соответствует" "Опробование\n Соответствует \n Не соответствует"
    if mem_1006="Соответствует"
        report OPROBIROVANIE "Соответствует"
    else
        report OPROBIROVANIE "Не соответствует"
        report result "не годным"
        EndScript
    endif
EndFunction

############ Функция плавной подстройки питания	########################################################################################################################
Function NASTROIKA_PITANIA					
	math mem_2141 = U_pit * mem_2140									
	DriverSet POWER_SUPPLY V = mem_2141
	#math mem_2 = U_pit
	#	if mem_2 > mem_2141
	#		repeat mem_2
	#		if mem_2 = mem_2141
	#		stoprepeat
	#		endif
	#		delay 100
	#		math mem_2 = mem_2 - 1
	#		DriverSet POWER_SUPPLY V = mem_2
	#		endrepeat
	#	else
	#		repeat mem_2
	#		if mem_2 = mem_2141
	#		stoprepeat
	#		endif
	#		delay 100
	#		math mem_2 = mem_2 + 1
	#		DriverSet POWER_SUPPLY V = mem_2
	#		
	#		endrepeat
	#	endif	
EndFunction


############ Функция сброса всех приборов ##############################################################################################################################
Function RESET_ALL
    DriverSet    LOAD_MODEL             RESET
    if "interface" = "true"
        DriverSet    Model_SI_Driver        RESET
    endif
    DriverSet    Keithley7001         RESET
    DriverSet    VOLTAGE_METER         RESET
    DriverSet    CURRENT_METER         RESET
    DriverSet    PULS_METER             RESET
    DriverSet    POWER_SUPPLY         V = 220
EndFunction



############ Проверка для нагрузки (нужно учитывать и ток, и напряжение, и мощность) ###################################################################################
Function TOK_NAGRUZKI
        if mem_3998 <= Load_Max_Curr                                 # Сравнение устанавливаемого значения тока с максимальным током Нагрузки
            math mem_1 = mem_3998*U_max
            if mem_1<=Load_Max_Power
                DriverSet LOAD_MODEL I_H = mem_3998
            else
                math mem_3998=Load_Max_Power/U_max
                DriverSet LOAD_MODEL I_H = mem_3998
            endif
        else 
            math mem_1 = I_max*U_max
            if mem_1<=Load_Max_Power
                DriverSet LOAD_MODEL I_H = Load_Max_Curr            # Если устанавливаемое значение больше максиманого тока Нагрузки - установить максимаотный ток нагрузки.
            else
                math mem_3998=Load_Max_Power/U_max
                DriverSet LOAD_MODEL I_H = mem_3998
            endif
        endif
EndFunction

Function TOK_NAGRUZKI_SER
        if mem_3998 <= Load_Max_Curr                                 # Сравнение устанавливаемого значения тока с максимальным током Нагрузки
            math mem_1 = mem_3998*U_max*2
            if mem_1<=Load_Max_Power
                DriverSet LOAD_MODEL I_H = mem_3998
            else
                math mem_3998=Load_Max_Power/(U_max*2)
                DriverSet LOAD_MODEL I_H = mem_3998
            endif
        else 
            math mem_1 = I_max*U_max*2
            if mem_1<=Load_Max_Power
                DriverSet LOAD_MODEL I_H = Load_Max_Curr            # Если устанавливаемое значение больше максиманого тока Нагрузки - установить максимаотный ток нагрузки.
            else
                math mem_3998=Load_Max_Power/(U_max*2)
                DriverSet LOAD_MODEL I_H = mem_3998
            endif
        endif
EndFunction

Function TOK_NAGRUZKI_PAR
        if mem_3998 <= Load_Max_Curr                                 # Сравнение устанавливаемого значения тока с максимальным током Нагрузки
            math mem_1 = mem_3998*U_max
            if mem_1<=Load_Max_Power
                DriverSet LOAD_MODEL I_H = mem_3998
            else
                math mem_3998=Load_Max_Power/U_max
                DriverSet LOAD_MODEL I_H = mem_3998
            endif
        else 
            math mem_1 = 2*I_max*U_max
            if mem_1<=Load_Max_Power
                DriverSet LOAD_MODEL I_H = Load_Max_Curr            # Если устанавливаемое значение больше максиманого тока Нагрузки - установить максимаотный ток нагрузки.
            else
                math mem_3998=Load_Max_Power/U_max
                DriverSet LOAD_MODEL I_H = mem_3998
            endif
        endif
EndFunction


#########################################################################################################################################################################
#######   Функции для определения метрологических характеристик   #######################################################################################################
#########################################################################################################################################################################

###################################################################################################################################################################
######## КАНАЛ 1 ####################################################################################################################################################
###################################################################################################################################################################

############ Определение основной погрешности установки выходного напряжения постоянного тока #########################################################################
#F/Результат ;        Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function VDC_CH1        mem_3        mem_2001                mem_3001                    mem_3999                        mem_69                        
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                    # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget VOLTAGE_METER mem_2101 = READ                                #    Запрос текущего значения вольтметра
# Расчет допустимой погрешности и отклонения
    math mem_2010 = VDC_coe * mem_2100 + VDC_con                #    Допустимое отклонение для точки
    math mem_2011=mem_2101-mem_2100                                     #    Вычисления модуля отклонения между точками
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    math mem_2019 = abs(mem_2011)
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;    Измеренное значение, В;    Отклонение, В;        Допуск, В;        Вывод о соответствии;
report VDC_MANY_CH          mem_3        mem_2100                mem_2101                    mem_2011            mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении напряжения питающей сети. ###################################################################
#F/Результат ;                Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;                
Function INSTB_U_Upit_CH1        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_2140                                
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max                                     #    Выходное напряжение источника
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                        # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значение напряжения в опорной точке    
        if mem_3999 = 0
        DriverSet LOAD_MODEL Load = Off                                        #    Включение нагрузки
        else
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        endif
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра
# Плавная подстройка напряжения входного питания
    call NASTROIKA_PITANIA
# Считывание значение напряжения при измененном напряжении входного питания
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2102 = READ                            #    Считать показания мультиметра
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности и отклонения
    math mem_3990 = mem_3999 * I_max
    If (mem_3990*I_max) <= 3
        math mem_2010 = VDCpit_coe * mem_2100 + VDCpit_con                    #    Допустимое отклонение для точки
    else
        math mem_2010 = VDCpit3_coe * mem_2100 + VDCpit3_con                    #    Допустимое отклонение для точки
    endif
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
    math mem_2011 = abs(mem_2101-mem_2102)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                     Номер канала;    Напряжение питания, В;    Поверяемая точка, В;    Измерение 1, В;    Измерение 2, В;    Нестабильность, В;    Допуск, В;        Вывод о соответствии;
report INSTB_U_Upit_MANY_CH    mem_3            mem_2141                mem_2100                mem_2101            mem_2102            mem_2011                mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении тока нагрузки. ##############################################################################
#F/Результат;                 Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходной ток от I_max 2, В;                
Function INSTB_U_Inagr_CH1        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_3997
# Установка тока нагрузки    
        math mem_3998 = mem_3999 * I_max
        call TOK_NAGRUZKI
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max                                    #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке с нагрузкой    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра с нагрузкой
            if mem_3999 != mem_3997    
            # Считывание значения напряжения в точке без нагрузки    
                math mem_3998 = mem_3997 * I_max
                call TOK_NAGRUZKI                                        #    Установка тока нагрузки            
                message wait=mem_69 "Ожидайте выполнения измерения"
                Driverget  VOLTAGE_METER mem_2102 = READ                #    Считать показания мультиметра без нагрузки
                math mem_2011 = mem_2102-mem_2101                         #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
            Else
                math mem_2011 = mem_2101-mem_2100                        #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
                string mem_2102 = "не измерялось в соотв. с методикой"
            Endif
# Расчет допустимой погрешности и отклонения
    math mem_3990 = mem_3999 * I_max
    If    mem_3990 <= 3
        math mem_2010 = VDCnagr_coe * mem_2100 + VDCnagr_con                #    Допустимое отклонение для точки
    else
        math mem_2010 = VDCnagr3_coe * mem_2100 + VDCnagr3_con                #    Допустимое отклонение для точки
    endif
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110=&'00B1' mem_2110                                     #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Поверяемая точка, В;    Показание источника с нагрузкой, В; Ток в нагрузке, А;    Показание источника без нагрузки, В;    Расчетная нестабильность;    Допуск;    Вывод о соответствии;
report INSTB_U_Inagr_MANY_CH        mem_3            mem_2100                mem_2101                        mem_3990                mem_2102                                mem_2019                    mem_2110    mem_2109
EndFunction

############ Определение пульсации выходного напряжения. ###############################################################################################################
#F/Результат;            Номер канала;    Напряжение СИ от U_max, В;                            Ток нагрузки от Imax, А;        Интервал жидания, с;        
Function PVDC_CH1           mem_3            mem_2001                                            mem_3999                    mem_69                
# Установка выходного напряжения источника    
    DriverSet    LOAD_MODEL             Load = Off
    math mem_2100 = mem_2001 * U_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного тока источника    
    math mem_3100 = I_max                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                    # для удаленно управляемого источника
    else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равный mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
    math mem_3998 = mem_3999 * I_max
    call TOK_NAGRUZKI
    DriverSet    LOAD_MODEL             Load = On

# Считывание значения пульсаций в точке        
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  PULS_METER mem_2011 = READ                                #    Считать показания мультиметра (ток)
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности
    math mem_2010 = VDCpuls_coe * mem_2100 + VDCpuls_con                #    Допустимое отклонение для точки
    math mem_2011 = rand(mem_2010)
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                      #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ПУЛЬСАЦИИ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;        Ток нагрузки, В;        Пульсации нагрузки, В;    Допуск;    Вывод о соответствии;
report PVDC_MANY_CH        mem_3        mem_2100                    mem_3998                mem_2011                    mem_2110        mem_2109
EndFunction

############ Определение абсолютной погрешности формирования силы выходного тока. ######################################################################################
#F/Результат;        Номер канала;        Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function IDC_CH1           mem_3            mem_3001                mem_2001                            mem_3999                    mem_69                            
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения
    math mem_3010 = IDC_coe * mem_3100 + IDC_con                #    Допустимое отклонение для точки    
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                     #    Добавление знака "+/-" для отчета
    math mem_3011 = mem_3101-mem_3100                                     #    Вычисления модуля отклонения для точки
# Сравнение и вывод
    math mem_3019 = abs(mem_3011)
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, А;    Показание источника, А;        Погрешность;    Допуск;        Вывод о соответствии;
report IDC_MANY_CH      mem_3                mem_3100                mem_3101                    mem_3011        mem_3110        mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении напряжения питающей сети. ######################################################################### 
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;     Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;        
Function INSTB_I_Upit_CH1        mem_3            mem_3001                mem_2001                    mem_3999                    mem_69                        mem_2140                             
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * U_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * I_max
    call TOK_NAGRUZKI
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max                                     
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в опорной точке
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Плавная подстройка напряжения входного питания    
    call NASTROIKA_PITANIA
# Считывание значение тока при измененном напряжении входного питания    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3102 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCpit_coe * mem_3100 + IDCpit_con                    #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                     #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
    math mem_3011 = abs(mem_3102-mem_3101)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_3109 mem_3011<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Напряжение питания, В;    Поверяемая точка, А;    Измерение 1, В;    Измерение 2, В;    Нестабильность;    Допуск;    Вывод о соответствии;
report INSTB_I_Upit_MANY_CH        mem_3            mem_2141                    mem_3100            mem_3101            mem_3102            mem_3011        mem_3110            mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении выходного напряжения. #############################################################################
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходное напряжение от U_max 2, В;
Function INSTB_I_Unagr_CH1       mem_3        mem_3001                mem_2001                       mem_3999                    mem_69                        mem_2003                           
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * I_max
    call TOK_NAGRUZKI
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                    # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * U_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке с нагрузкой
    DriverSet LOAD_MODEL Load = On
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #    Считать показания мультиметра с нагрузкой (ток)
        DriverSet LOAD_MODEL Load = Off
        if mem_2001 != mem_2003
        # Определение значения напряжения в нагрузке    
        math mem_2002 = U_max * mem_2003                                    #    Расчет значения напряжения в поверяемой точке
            If Interface = true
                DriverSet Model_SI_Driver VDC = mem_2002                                                                                       # для удаленно управляемого источника
            else
                Message mem_2002 checksyntax  defvalue=mem_2002 "Установите на источнике выходное напряжение равное mem_2002, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
            endif
        # Считывание значения тока в точке без нагрузки    
        DriverSet LOAD_MODEL Load = On
        message wait=mem_69 "Ожидайте выполнения измерения"
        Driverget  CURRENT_METER mem_3102 = IDC                                #    Считать показания мультиметра без нагрузки (ток)
        math mem_3011 = mem_3101-mem_3102                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)
        else
        math mem_3011 = mem_3101-mem_3100                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)                                    #    Вычисления модуля отклонения между точками
        string mem_3102 = "не измерялось в соотв. с методикой"
        endif
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCnagr_coe * mem_3100 + IDCnagr_con                #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Значение тока в точке, А;    Показание источника с нагрузкой, А;    Напряжение в нагрузке, В;    Показание источника без нагрузки, А;    Нестабильность, А;    Допуск, А;    Вывод о соответствии;
report INSTB_I_Unagr_MANY_CH        mem_3            mem_3100                    mem_3101                                    mem_2100                        mem_3102                                mem_3011            mem_3110    mem_3109
EndFunction


############ Определение пульсации выходного тока. #####################################################################################################################
#F/Результат;		Номер канала;		Ток СИ от Imax, А;	Напряжение СИ от U_max, В;	Ток нагрузки от Imax, А;		Интервал жидания, с;	
Function PIDC_CH1 		mem_3				mem_3001				mem_2001					mem_3999					mem_69					
# Установка выходного напряжения источника	
	DriverSet	LOAD_MODEL 			Load = Off
	math mem_2100 = mem_2001 * U_max
	If Interface = true
		DriverSet Model_SI_Driver VDC = mem_2100   																					# для удаленно управляемого источника
		else
		Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100 ,В \n если это не удается, введите наиболее близкое значение, которое можете установить"		# для источника без интерфейса
	endif
	DriverSet	LOAD_MODEL 			Load = On
# Считывание значения напряжения в точке
	message wait=mem_69 "Ожидайте выполнения измерения"
	Driverget  PULS_METER mem_3101 = READ								#	Считать показания мультиметра (ток)
# Расчет допустимой погрешности 	
	math mem_3010 = IDCpuls_coe * mem_3100 + IDCpuls_con				#	Допустимое отклонение для точки
	math mem_3101 = rand(mem_3010)
	math mem_3110 = mem_3010 * 1000                           		    #	Перевод в милиамперы
	string mem_6666=GetField(mem_3110;".";1)
	string mem_7777=GetField(mem_3110;".";2)
		if mem_7777 = Nan
		math mem_7777 = 0
		endif
	string mem_3110= mem_6666||","||mem_7777
	string mem_3110 = &'00B1' mem_3110                                	#	Добавление знака "+/-" для отчета
# Сравнение и вывод
	compare mem_3109 mem_3101<=mem_3010 description="ПУЛЬСАЦИИ НЕ В ДОПУСКЕ!"	# 	Определение нахождения значения в дропуске
# в отчет 				Номер канала;	Поверяемая точка, А;	Выходное напряжение, В;	Пульсации;		Допуск;		Вывод о соответствии;
report PIDC_MANY_CH		mem_3			mem_3100				mem_2100				mem_3101		mem_3110		mem_3109
EndFunction


###################################################################################################################################################################
######## КАНАЛ 2 ####################################################################################################################################################
###################################################################################################################################################################

############ Определение основной погрешности установки выходного напряжения постоянного тока #########################################################################
#F/Результат ;        Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function VDC_CH2        mem_3        mem_2001                mem_3001                    mem_3999                        mem_69                        
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                    # для удаленно управляемого источника
    else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget VOLTAGE_METER mem_2101 = READ                                #    Запрос текущего значения вольтметра
# Расчет допустимой погрешности и отклонения
    math mem_2010 = VDC_coe * mem_2100 + VDC_con                #    Допустимое отклонение для точки    
    math mem_2011=mem_2101-mem_2100                                     #    Вычисления модуля отклонения между точками
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    math mem_2019 = abs(mem_2011)
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;    Измеренное значение, В;    Отклонение, В;        Допуск, В;        Вывод о соответствии;
report VDC_MANY_CH          mem_3        mem_2100                mem_2101                    mem_2011            mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении напряжения питающей сети. ###################################################################
#F/Результат ;                Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;                
Function INSTB_U_Upit_CH2        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_2140                                
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max                                     #    Выходное напряжение источника
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                        # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значение напряжения в опорной точке    
        if mem_3999 = 0
        DriverSet LOAD_MODEL Load = Off                                        #    Включение нагрузки
        else
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        endif
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра
# Плавная подстройка напряжения входного питания
    call NASTROIKA_PITANIA
# Считывание значение напряжения при измененном напряжении входного питания
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2102 = READ                            #    Считать показания мультиметра
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности и отклонения
    math mem_3990 = mem_3999 * I_max
    If (mem_3990*I_max) <= 3
        math mem_2010 = VDCpit_coe * mem_2100 + VDCpit_con                    #    Допустимое отклонение для точки
    else
        math mem_2010 = VDCpit3_coe * mem_2100 + VDCpit3_con                    #    Допустимое отклонение для точки
    endif
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
    math mem_2011 = abs(mem_2101-mem_2102)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                     Номер канала;    Напряжение питания, В;    Поверяемая точка, В;    Измерение 1, В;    Измерение 2, В;    Нестабильность, В;    Допуск, В;        Вывод о соответствии;
report INSTB_U_Upit_MANY_CH    mem_3            mem_2141                mem_2100                mem_2101            mem_2102            mem_2011                mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении тока нагрузки. ##############################################################################
#F/Результат;                 Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходной ток от I_max 2, В;                
Function INSTB_U_Inagr_CH2        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_3997
# Установка тока нагрузки    
        math mem_3998 = mem_3999 * I_max
        call TOK_NAGRUZKI
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max                                    #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке с нагрузкой    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра с нагрузкой
            if mem_3999 != mem_3997    
            # Считывание значения напряжения в точке без нагрузки    
                math mem_3998 = mem_3997 * I_max
                call TOK_NAGRUZKI                                        #    Установка тока нагрузки            
                message wait=mem_69 "Ожидайте выполнения измерения"
                Driverget  VOLTAGE_METER mem_2102 = READ                #    Считать показания мультиметра без нагрузки
                math mem_2011 = mem_2102-mem_2101                         #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
            Else
                math mem_2011 = mem_2101-mem_2100                        #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
                string mem_2102 = "не измерялось в соотв. с методикой"
            Endif
# Расчет допустимой погрешности и отклонения
    math mem_3990 = mem_3999 * I_max
    If    mem_3990 <= 3
        math mem_2010 = VDCnagr_coe * mem_2100 + VDCnagr_con                #    Допустимое отклонение для точки
    else
        math mem_2010 = VDCnagr3_coe * mem_2100 + VDCnagr3_con                #    Допустимое отклонение для точки
    endif
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110=&'00B1' mem_2110                                     #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Поверяемая точка, В;    Показание источника с нагрузкой, В; Ток в нагрузке, А;    Показание источника без нагрузки, В;    Расчетная нестабильность;    Допуск;    Вывод о соответствии;
report INSTB_U_Inagr_MANY_CH        mem_3            mem_2100                mem_2101                        mem_3990                mem_2102                                mem_2019                    mem_2110    mem_2109
EndFunction

############ Определение пульсации выходного напряжения. ###############################################################################################################
#F/Результат;            Номер канала;    Напряжение СИ от U_max, В;                            Ток нагрузки от Imax, А;        Интервал жидания, с;        
Function PVDC_CH2           mem_3            mem_2001                                            mem_3999                    mem_69                
# Установка выходного напряжения источника    
    DriverSet    LOAD_MODEL             Load = Off
    math mem_2100 = mem_2001 * U_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного тока источника    
    math mem_3100 = I_max                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                    # для удаленно управляемого источника
    else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равный mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
    math mem_3998 = mem_3999 * I_max
    call TOK_NAGRUZKI
    DriverSet    LOAD_MODEL             Load = On
# Считывание значения пульсаций в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  PULS_METER mem_2011 = READ                                #    Считать показания мультиметра (ток)
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности
    math mem_2010 = VDCpuls_coe * mem_2100 + VDCpuls_con                #    Допустимое отклонение для точки
    math mem_2011 = rand(mem_2010)
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                      #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ПУЛЬСАЦИИ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;        Ток нагрузки, В;        Пульсации нагрузки, В;    Допуск;    Вывод о соответствии;
report PVDC_MANY_CH        mem_3        mem_2100                    mem_3998                mem_2011                    mem_2110        mem_2109
EndFunction

############ Определение абсолютной погрешности формирования силы выходного тока. ######################################################################################
#F/Результат;        Номер канала;        Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function IDC_CH2           mem_3            mem_3001                mem_2001                            mem_3999                    mem_69                            
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDC_coe * mem_3100 + IDC_con                    #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                     #    Добавление знака "+/-" для отчета
    math mem_3011 = mem_3101-mem_3100                                     #    Вычисления модуля отклонения для точки
# Сравнение и вывод
    math mem_3019 = abs(mem_3011)
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, А;    Показание источника, А;        Погрешность;    Допуск;        Вывод о соответствии;
report IDC_MANY_CH      mem_3                mem_3100                mem_3101                    mem_3011        mem_3110        mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении напряжения питающей сети. ######################################################################### 
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;     Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;        
Function INSTB_I_Upit_CH2        mem_3            mem_3001                mem_2001                    mem_3999                    mem_69                        mem_2140                             
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * U_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * I_max
    call TOK_NAGRUZKI
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max                                     
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Считывание значения тока в опорной точке
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Плавная подстройка напряжения входного питания    
    call NASTROIKA_PITANIA
# Считывание значение тока при измененном напряжении входного питания    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3102 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCpit_coe * mem_3100 + IDCpit_con                    #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                     #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
    math mem_3011 = abs(mem_3102-mem_3101)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_3109 mem_3011<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Напряжение питания, В;    Поверяемая точка, А;    Измерение 1, В;    Измерение 2, В;    Нестабильность;    Допуск;    Вывод о соответствии;
report INSTB_I_Upit_MANY_CH        mem_3            mem_2141                    mem_3100            mem_3101            mem_3102            mem_3011        mem_3110            mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении выходного напряжения. #############################################################################
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходное напряжение от U_max 2, В;
Function INSTB_I_Unagr_CH2       mem_3        mem_3001                mem_2001                       mem_3999                    mem_69                        mem_2003                           
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * I_max
    call TOK_NAGRUZKI
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                    # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * U_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке с нагрузкой
    DriverSet LOAD_MODEL Load = On
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #    Считать показания мультиметра с нагрузкой (ток)
        DriverSet LOAD_MODEL Load = Off
        if mem_2001 != mem_2003
        # Определение значения напряжения в нагрузке    
        math mem_2002 = U_max * mem_2003                                    #    Расчет значения напряжения в поверяемой точке
            If Interface = true
                DriverSet Model_SI_Driver VDC = mem_2002                                                                                       # для удаленно управляемого источника
            else
                Message mem_2002 checksyntax  defvalue=mem_2002 "Установите на источнике выходное напряжение равное mem_2002, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
            endif
        # Считывание значения тока в точке без нагрузки    
        DriverSet LOAD_MODEL Load = On
        message wait=mem_69 "Ожидайте выполнения измерения"
        Driverget  CURRENT_METER mem_3102 = IDC                                #    Считать показания мультиметра без нагрузки (ток)
        math mem_3011 = mem_3101-mem_3102                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)
        else
        math mem_3011 = mem_3101-mem_3100                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)                                    #    Вычисления модуля отклонения между точками
        string mem_3102 = "не измерялось в соотв. с методикой"
        endif
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCnagr_coe * mem_3100 + IDCnagr_con                #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Значение тока в точке, А;    Показание источника с нагрузкой, А;    Напряжение в нагрузке, В;    Показание источника без нагрузки, А;    Нестабильность, А;    Допуск, А;    Вывод о соответствии;
report INSTB_I_Unagr_MANY_CH        mem_3            mem_3100                    mem_3101                                mem_2100                        mem_3102                                    mem_3011            mem_3110    mem_3109
EndFunction

############ Определение пульсации выходного тока. #####################################################################################################################
#F/Результат;		Номер канала;		Ток СИ от Imax, А;	Напряжение СИ от U_max, В;	Ток нагрузки от Imax, А;		Интервал жидания, с;	
Function PIDC_CH2 		mem_3				mem_3001				mem_2001					mem_3999					mem_69					
# Установка выходного напряжения источника	
	DriverSet	LOAD_MODEL 			Load = Off
	math mem_2100 = mem_2001 * U_max
	If Interface = true
		DriverSet Model_SI_Driver VDC = mem_2100   																					# для удаленно управляемого источника
		else
		Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100 ,В \n если это не удается, введите наиболее близкое значение, которое можете установить"		# для источника без интерфейса
	endif
	DriverSet	LOAD_MODEL 			Load = On
# Считывание значения напряжения в точке
	message wait=mem_69 "Ожидайте выполнения измерения"
	Driverget  PULS_METER mem_3101 = READ								#	Считать показания мультиметра (ток)
# Расчет допустимой погрешности 	
	math mem_3010 = IDCpuls_coe * mem_3100 + IDCpuls_con				#	Допустимое отклонение для точки
	math mem_3101 = rand(mem_3010)
	math mem_3110 = mem_3010 * 1000                           		    #	Перевод в милиамперы
	string mem_6666=GetField(mem_3110;".";1)
	string mem_7777=GetField(mem_3110;".";2)
		if mem_7777 = Nan
		math mem_7777 = 0
		endif
	string mem_3110= mem_6666||","||mem_7777
	string mem_3110 = &'00B1' mem_3110                                	#	Добавление знака "+/-" для отчета
# Сравнение и вывод
	compare mem_3109 mem_3101<=mem_3010 description="ПУЛЬСАЦИИ НЕ В ДОПУСКЕ!"	# 	Определение нахождения значения в дропуске
# в отчет 				Номер канала;	Поверяемая точка, А;	Выходное напряжение, В;	Пульсации;		Допуск;		Вывод о соответствии;
report PIDC_MANY_CH		mem_3			mem_3100				mem_2100				mem_3101		mem_3110		mem_3109
EndFunction

###################################################################################################################################################################
######## КАНАЛ 3 ####################################################################################################################################################
###################################################################################################################################################################

############ Определение основной погрешности установки выходного напряжения постоянного тока #########################################################################
#F/Результат ;        Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function VDC_CH3        mem_3        mem_2001                mem_3001                    mem_3999                        mem_69                        
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * Uch3_max                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                    # для удаленно управляемого источника
    else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget VOLTAGE_METER mem_2101 = READ                                #    Запрос текущего значения вольтметра
# Расчет допустимой погрешности и отклонения
    math mem_2010 = VDCch3_coe * mem_2100 + VDCch3_con                #    Допустимое отклонение для точки
    math mem_2011=mem_2101-mem_2100                                     #    Вычисления модуля отклонения между точками
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    math mem_2019 = abs(mem_2011)
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;    Измеренное значение, В;    Отклонение, В;        Допуск, В;        Вывод о соответствии;
report VDC_MANY_CH          mem_3        mem_2100                mem_2101                    mem_2011            mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении напряжения питающей сети. ###################################################################
#F/Результат ;                Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;                
Function INSTB_U_Upit_CH3        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_2140                                
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * Uch3_max                                     #    Выходное напряжение источника
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                        # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значение напряжения в опорной точке    
        if mem_3999 = 0
        DriverSet LOAD_MODEL Load = Off                                        #    Включение нагрузки
        else
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        endif
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра
# Плавная подстройка напряжения входного питания
    call NASTROIKA_PITANIA
# Считывание значение напряжения при измененном напряжении входного питания
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2102 = READ                            #    Считать показания мультиметра
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности и отклонения
    math mem_2010 = VDCch3_pit_coe * mem_2100 + VDCch3_pit_con                    #    Допустимое отклонение для точки
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
    math mem_2011 = abs(mem_2101-mem_2102)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                     Номер канала;    Напряжение питания, В;    Поверяемая точка, В;    Измерение 1, В;    Измерение 2, В;    Нестабильность, В;    Допуск, В;        Вывод о соответствии;
report INSTB_U_Upit_MANY_CH    mem_3            mem_2141                mem_2100                mem_2101            mem_2102            mem_2011                mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении тока нагрузки. ##############################################################################
#F/Результат;                 Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходной ток от I_max 2, В;                
Function INSTB_U_Inagr_CH3        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_3997
# Установка тока нагрузки    
        math mem_3998 = mem_3999 * Ich3_max
        call TOK_NAGRUZKI
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * Uch3_max                                    #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке с нагрузкой    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра с нагрузкой
            if mem_3999 != mem_3997    
            # Считывание значения напряжения в точке без нагрузки    
                math mem_3998 = mem_3997 * Ich3_max
                call TOK_NAGRUZKI                                        #    Установка тока нагрузки            
                message wait=mem_69 "Ожидайте выполнения измерения"
                Driverget  VOLTAGE_METER mem_2102 = READ                #    Считать показания мультиметра без нагрузки
                math mem_2011 = mem_2102-mem_2101                         #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
            Else
                math mem_2011 = mem_2101-mem_2100                        #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
                string mem_2102 = "не измерялось в соотв. с методикой"
            Endif
# Расчет допустимой погрешности и отклонения
    math mem_3990 = mem_3999 * Ich3_max
    math mem_2010 = VDCch3_nagr_coe * mem_2100 + VDCch3_nagr_con                #    Допустимое отклонение для точки
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110=&'00B1' mem_2110                                     #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
    # в отчет                         Номер канала;    Поверяемая точка, В;    Показание источника с нагрузкой, В; Ток в нагрузке, А;    Показание источника без нагрузки, В;    Расчетная нестабильность;    Допуск;    Вывод о соответствии;
    report INSTB_U_Inagr_MANY_CH        mem_3            mem_2100                mem_2101                        mem_3990                mem_2102                                mem_2019                    mem_2110    mem_2109
EndFunction

############ Определение пульсации выходного напряжения. ###############################################################################################################
#F/Результат;            Номер канала;    Напряжение СИ от U_max, В;                            Ток нагрузки от Imax, А;        Интервал жидания, с;        
Function PVDC_CH3           mem_3            mem_2001                                            mem_3999                    mem_69                
# Установка выходного напряжения источника    
    DriverSet    LOAD_MODEL             Load = Off
    math mem_2100 = mem_2001 * Uch3_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного тока источника    
    math mem_3100 = I_ch3max                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                    # для удаленно управляемого источника
    else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равный mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
    math mem_3998 = mem_3999 * Ich3_max
    call TOK_NAGRUZKI
    DriverSet    LOAD_MODEL             Load = On

# Считывание значения пульсаций в точке                                        
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  PULS_METER mem_2011 = READ                                #    Считать показания мультиметра (ток)
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности
    math mem_2010 = VDCch3_puls_coe * mem_2100 + VDCch3_puls_con                #    Допустимое отклонение для точки
    math mem_2011 = rand(mem_2010)
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                      #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ПУЛЬСАЦИИ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;        Ток нагрузки, В;        Пульсации нагрузки, В;    Допуск;    Вывод о соответствии;
report PVDC_MANY_CH        mem_3        mem_2100                    mem_3998                mem_2011                    mem_2110        mem_2109
EndFunction

############ Определение абсолютной погрешности формирования силы выходного тока. ######################################################################################
#F/Результат;        Номер канала;        Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function IDC_CH3           mem_3            mem_3001                mem_2001                            mem_3999                    mem_69                            
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * Ich3_max                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCch3_coe * mem_3100 + IDCch3_con                #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                     #    Добавление знака "+/-" для отчета
    math mem_3011 = mem_3101-mem_3100                                     #    Вычисления модуля отклонения для точки
# Сравнение и вывод
    math mem_3019 = abs(mem_3011)
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, А;    Показание источника, А;        Погрешность;    Допуск;        Вывод о соответствии;
report IDC_MANY_CH      mem_3                mem_3100                mem_3101                    mem_3011        mem_3110        mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении напряжения питающей сети. ######################################################################### 
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;     Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;        
Function INSTB_I_Upit_CH3        mem_3            mem_3001                mem_2001                    mem_3999                    mem_69                        mem_2140                             
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * Uch3_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * Ich3_max
    call TOK_NAGRUZKI
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * Ich3_max                                     
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Считывание значения тока в опорной точке
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Плавная подстройка напряжения входного питания    
    call NASTROIKA_PITANIA
# Считывание значение тока при измененном напряжении входного питания    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3102 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCch3_pit_coe * mem_3100 + IDCch3_pit_con                    #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                     #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
    math mem_3011 = abs(mem_3102-mem_3101)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_3109 mem_3011<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Напряжение питания, В;    Поверяемая точка, А;    Измерение 1, В;    Измерение 2, В;    Нестабильность;    Допуск;    Вывод о соответствии;
report INSTB_I_Upit_MANY_CH        mem_3            mem_2141                    mem_3100            mem_3101            mem_3102            mem_3011        mem_3110            mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении выходного напряжения. #############################################################################
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходное напряжение от U_max 2, В;
Function INSTB_I_Unagr_CH3       mem_3        mem_3001                mem_2001                       mem_3999                    mem_69                        mem_2003                           
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * Ich3_max
    call TOK_NAGRUZKI
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * Ich3_max                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                    # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * Uch3_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке с нагрузкой
    DriverSet LOAD_MODEL Load = On
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #    Считать показания мультиметра с нагрузкой (ток)
        DriverSet LOAD_MODEL Load = Off
        if mem_2001 != mem_2003
        # Определение значения напряжения в нагрузке    
        math mem_2002 = Uch3_max * mem_2003                                    #    Расчет значения напряжения в поверяемой точке
            If Interface = true
                DriverSet Model_SI_Driver VDC = mem_2002                                                                                       # для удаленно управляемого источника
            else
                Message mem_2002 checksyntax  defvalue=mem_2002 "Установите на источнике выходное напряжение равное mem_2002, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
            endif
        # Считывание значения тока в точке без нагрузки    
        DriverSet LOAD_MODEL Load = On
        message wait=mem_69 "Ожидайте выполнения измерения"
        Driverget  CURRENT_METER mem_3102 = IDC                                #    Считать показания мультиметра без нагрузки (ток)
        math mem_3011 = mem_3101-mem_3102                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)
        else
        math mem_3011 = mem_3101-mem_3100                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)                                    #    Вычисления модуля отклонения между точками
        string mem_3102 = "не измерялось в соотв. с методикой"
        endif
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCch3_nagr_coe * mem_3100 + IDCch3_nagr_con                #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Значение тока в точке, А;    Показание источника с нагрузкой, А;    Напряжение в нагрузке, В;    Показание источника без нагрузки, А;    Нестабильность, А;    Допуск, А;    Вывод о соответствии;
report INSTB_I_Unagr_MANY_CH        mem_3            mem_3100                    mem_3101                                mem_2100                        mem_3102                                    mem_3011            mem_3110    mem_3109
EndFunction

###################################################################################################################################################################
######## Параллельное включение ####################################################################################################################################################
###################################################################################################################################################################

############ Определение основной погрешности установки выходного напряжения постоянного тока #########################################################################
#F/Результат ;        Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function VDC_PAR        mem_3        mem_2001                mem_3001                    mem_3999                        mem_69                        
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                    # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget VOLTAGE_METER mem_2101 = READ                                #    Запрос текущего значения вольтметра
# Расчет допустимой погрешности и отклонения
    math mem_2010 = VDC_coe * mem_2100 + VDC_con                #    Допустимое отклонение для точки
    math mem_2011=mem_2101-mem_2100                                     #    Вычисления модуля отклонения между точками
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    math mem_2019 = abs(mem_2011)
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;    Измеренное значение, В;    Отклонение, В;        Допуск, В;        Вывод о соответствии;
report VDC_MANY_CH          mem_3        mem_2100                mem_2101                    mem_2011            mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении напряжения питающей сети. ###################################################################
#F/Результат ;                Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;                
Function INSTB_U_Upit_PAR        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_2140                                
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max                                     #    Выходное напряжение источника
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                        # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значение напряжения в опорной точке    
        if mem_3999 = 0
        DriverSet LOAD_MODEL Load = Off                                        #    Включение нагрузки
        else
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        endif
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра
# Плавная подстройка напряжения входного питания
    call NASTROIKA_PITANIA
# Считывание значение напряжения при измененном напряжении входного питания
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2102 = READ                            #    Считать показания мультиметра
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности и отклонения
    math mem_3990 = mem_3999 * I_max * 2
    If (mem_3990) <= 3
        math mem_2010 = VDCpit_coe * mem_2100 + VDCpit_con                    #    Допустимое отклонение для точки
    else
        math mem_2010 = VDCpit3_coe * mem_2100 + VDCpit3_con                    #    Допустимое отклонение для точки
    endif
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
    math mem_2011 = abs(mem_2101-mem_2102)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                     Номер канала;    Напряжение питания, В;    Поверяемая точка, В;    Измерение 1, В;    Измерение 2, В;    Нестабильность, В;    Допуск, В;        Вывод о соответствии;
report INSTB_U_Upit_MANY_CH    mem_3            mem_2141                mem_2100                mem_2101            mem_2102            mem_2011                mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении тока нагрузки. ##############################################################################
#F/Результат;                 Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходной ток от I_max 2, В;                
Function INSTB_U_Inagr_PAR        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_3997
# Установка тока нагрузки    
        math mem_3998 = mem_3999 * I_max*2
        call TOK_NAGRUZKI_PAR
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max                                    #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке с нагрузкой    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра с нагрузкой
            if mem_3999 != mem_3997    
            # Считывание значения напряжения в точке без нагрузки    
                math mem_3998 = mem_3997 * I_max*2
                call TOK_NAGRUZKI_PAR                                        #    Установка тока нагрузки            
                message wait=mem_69 "Ожидайте выполнения измерения"
                Driverget  VOLTAGE_METER mem_2102 = READ                #    Считать показания мультиметра без нагрузки
                math mem_2011 = mem_2102-mem_2101                         #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
            Else
                math mem_2011 = mem_2101-mem_2100                        #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
                string mem_2102 = "не измерялось в соотв. с методикой"
            Endif
# Расчет допустимой погрешности и отклонения
    math mem_3990 = mem_3999 * I_max*2
    If    mem_3990 <= 3
        math mem_2010 = VDCnagr_coe * mem_2100 + VDCnagr_con                #    Допустимое отклонение для точки
    else
        math mem_2010 = VDCnagr3_coe * mem_2100 + VDCnagr3_con                #    Допустимое отклонение для точки
    endif
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110=&'00B1' mem_2110                                     #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Поверяемая точка, В;    Показание источника с нагрузкой, В; Ток в нагрузке, А;    Показание источника без нагрузки, В;    Расчетная нестабильность;    Допуск;    Вывод о соответствии;
report INSTB_U_Inagr_MANY_CH        mem_3            mem_2100                mem_2101                        mem_3990                mem_2102                                mem_2019                    mem_2110    mem_2109
EndFunction

############ Определение пульсации выходного напряжения. ###############################################################################################################
#F/Результат;            Номер канала;    Напряжение СИ от U_max, В;                            Ток нагрузки от Imax, А;        Интервал жидания, с;        
Function PVDC_PAR           mem_3            mem_2001                                            mem_3999                    mem_69                
# Установка выходного напряжения источника    
    DriverSet    LOAD_MODEL             Load = Off
    math mem_2100 = mem_2001 * U_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного тока источника    
    math mem_3100 = I_max*2                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                    # для удаленно управляемого источника
    else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равный mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
    math mem_3998 = mem_3999 * I_max*2
    call TOK_NAGRUZKI
    DriverSet    LOAD_MODEL             Load = On
# Считывание значения пульсаций в точке        
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  PULS_METER mem_2011 = READ                                #    Считать показания мультиметра (ток)
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности
    math mem_2010 = VDCpuls_coe * mem_2100 + VDCpuls_con                #    Допустимое отклонение для точки
    math mem_2011 = rand(mem_2010)
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                      #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ПУЛЬСАЦИИ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;        Ток нагрузки, В;        Пульсации нагрузки, В;    Допуск;    Вывод о соответствии;
report PVDC_MANY_CH        mem_3        mem_2100                    mem_3998                mem_2011                    mem_2110        mem_2109
EndFunction

############ Определение абсолютной погрешности формирования силы выходного тока. ######################################################################################
#F/Результат;        Номер канала;        Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function IDC_PAR           mem_3            mem_3001                mem_2001                            mem_3999                    mem_69                            
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max*2                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения
    math mem_3010 = IDC_coe * mem_3100 + IDC_con                #    Допустимое отклонение для точки    
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                     #    Добавление знака "+/-" для отчета
    math mem_3011 = mem_3101-mem_3100                                     #    Вычисления модуля отклонения для точки
# Сравнение и вывод
    math mem_3019 = abs(mem_3011)
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, А;    Показание источника, А;        Погрешность;    Допуск;        Вывод о соответствии;
report IDC_MANY_CH      mem_3                mem_3100                mem_3101                    mem_3011        mem_3110        mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении напряжения питающей сети. ######################################################################### 
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;     Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;        
Function INSTB_I_Upit_PAR        mem_3            mem_3001                mem_2001                    mem_3999                    mem_69                        mem_2140                             
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * U_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * I_max*2
    call TOK_NAGRUZKI_PAR
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max*2                                     
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в опорной точке
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Плавная подстройка напряжения входного питания    
    call NASTROIKA_PITANIA
# Считывание значение тока при измененном напряжении входного питания    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3102 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCpit_coe * mem_3100 + IDCpit_con                    #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                     #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
    math mem_3011 = abs(mem_3102-mem_3101)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_3109 mem_3011<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Напряжение питания, В;    Поверяемая точка, А;    Измерение 1, В;    Измерение 2, В;    Нестабильность;    Допуск;    Вывод о соответствии;
report INSTB_I_Upit_MANY_CH        mem_3            mem_2141                    mem_3100            mem_3101            mem_3102            mem_3011        mem_3110            mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении выходного напряжения. #############################################################################
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходное напряжение от U_max 2, В;
Function INSTB_I_Unagr_PAR       mem_3        mem_3001                mem_2001                       mem_3999                    mem_69                        mem_2003                           
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * I_max*2
    call TOK_NAGRUZKI_PAR
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max*2                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                    # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * U_max
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке с нагрузкой
    DriverSet LOAD_MODEL Load = On
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #    Считать показания мультиметра с нагрузкой (ток)
        DriverSet LOAD_MODEL Load = Off
        if mem_2001 != mem_2003
        # Определение значения напряжения в нагрузке    
        math mem_2002 = U_max * mem_2003                                    #    Расчет значения напряжения в поверяемой точке
            If Interface = true
                DriverSet Model_SI_Driver VDC = mem_2002                                                                                       # для удаленно управляемого источника
            else
                Message mem_2002 checksyntax  defvalue=mem_2002 "Установите на источнике выходное напряжение равное mem_2002, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
            endif
        # Считывание значения тока в точке без нагрузки    
        DriverSet LOAD_MODEL Load = On
        message wait=mem_69 "Ожидайте выполнения измерения"
        Driverget  CURRENT_METER mem_3102 = IDC                                #    Считать показания мультиметра без нагрузки (ток)
        math mem_3011 = mem_3101-mem_3102                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)
        else
        math mem_3011 = mem_3101-mem_3100                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)                                    #    Вычисления модуля отклонения между точками
        string mem_3102 = "не измерялось в соотв. с методикой"
        endif
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCnagr_coe * mem_3100 + IDCnagr_con                #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Значение тока в точке, А;    Показание источника с нагрузкой, А;    Напряжение в нагрузке, В;    Показание источника без нагрузки, А;    Нестабильность, А;    Допуск, А;    Вывод о соответствии;
report INSTB_I_Unagr_MANY_CH        mem_3            mem_3100                    mem_3101                                mem_2100                            mem_3102                                mem_3011            mem_3110    mem_3109
EndFunction

###################################################################################################################################################################
######## Последовательное включение ####################################################################################################################################################
###################################################################################################################################################################

############ Определение основной погрешности установки выходного напряжения постоянного тока #########################################################################
#F/Результат ;        Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function VDC_SER        mem_3        mem_2001                mem_3001                    mem_3999                        mem_69                        
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max * 2                                    #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                    # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget VOLTAGE_METER mem_2101 = READ                                #    Запрос текущего значения вольтметра
# Расчет допустимой погрешности и отклонения
    math mem_2010 = VDC_coe * mem_2100 + VDC_con                #    Допустимое отклонение для точки
    math mem_2011=mem_2101-mem_2100                                     #    Вычисления модуля отклонения между точками
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    math mem_2019 = abs(mem_2011)
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;    Измеренное значение, В;    Отклонение, В;        Допуск, В;        Вывод о соответствии;
report VDC_MANY_CH          mem_3        mem_2100                mem_2101                    mem_2011            mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении напряжения питающей сети. ###################################################################
#F/Результат ;                Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;                
Function INSTB_U_Upit_SER        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_2140                                
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max *2                                     #    Выходное напряжение источника
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                        # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значение напряжения в опорной точке    
        if mem_3999 = 0
        DriverSet LOAD_MODEL Load = Off                                        #    Включение нагрузки
        else
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        endif
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра
# Плавная подстройка напряжения входного питания
    call NASTROIKA_PITANIA
# Считывание значение напряжения при измененном напряжении входного питания
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2102 = READ                            #    Считать показания мультиметра
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности и отклонения
    math mem_3990 = mem_3999 * I_max
    math mem_2010 = VDCser_pit_coe * mem_2100 + VDCser_pit_con                    #    Допустимое отклонение для точки
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                    #    Добавление знака "+/-" для отчета
    math mem_2011 = abs(mem_2101-mem_2102)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                     Номер канала;    Напряжение питания, В;    Поверяемая точка, В;    Измерение 1, В;    Измерение 2, В;    Нестабильность, В;    Допуск, В;        Вывод о соответствии;
report INSTB_U_Upit_MANY_CH    mem_3            mem_2141                mem_2100                mem_2101            mem_2102            mem_2011                mem_2110        mem_2109
EndFunction

############ Определение нестабильности выходного напряжения при изменении тока нагрузки. ##############################################################################
#F/Результат;                 Номер канала;    Напряжение СИ от U_max, В;    Ток СИ от Imax, А;        Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходной ток от I_max 2, В;                
Function INSTB_U_Inagr_SER        mem_3            mem_2001                mem_3001                    mem_3999                    mem_69                        mem_3997
# Установка тока нагрузки    
        math mem_3998 = mem_3999 * I_max
        call TOK_NAGRUZKI_SER
# Установка выходного напряжения источника    
    math mem_2100 = mem_2001 * U_max * 2                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения напряжения в точке с нагрузкой    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  VOLTAGE_METER mem_2101 = READ                            #    Считать показания мультиметра с нагрузкой
            if mem_3999 != mem_3997    
            # Считывание значения напряжения в точке без нагрузки    
                math mem_3998 = mem_3997 * I_max
                call TOK_NAGRUZKI_SER                                        #    Установка тока нагрузки            
                message wait=mem_69 "Ожидайте выполнения измерения"
                Driverget  VOLTAGE_METER mem_2102 = READ                #    Считать показания мультиметра без нагрузки
                math mem_2011 = mem_2102-mem_2101                         #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
            Else
                math mem_2011 = mem_2101-mem_2100                        #    Вычисления отклонения между точками
                math mem_2019 = abs(mem_2011)                            #    Вычисления модуля отклонения
                string mem_2102 = "не измерялось в соотв. с методикой"
            Endif
# Расчет допустимой погрешности и отклонения
    math mem_3990 = mem_3999 * I_max
    math mem_2010 = VDCser_nagr_coe * mem_2100 + VDCser_nagr_con                #    Допустимое отклонение для точки
    math mem_2110 = mem_2010 * 1000                                     #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110=&'00B1' mem_2110                                     #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2019<=mem_2010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Поверяемая точка, В;    Показание источника с нагрузкой, В; Ток в нагрузке, А;    Показание источника без нагрузки, В;    Расчетная нестабильность;    Допуск;    Вывод о соответствии;
report INSTB_U_Inagr_MANY_CH        mem_3            mem_2100                mem_2101                        mem_3990                mem_2102                                mem_2019                    mem_2110    mem_2109
EndFunction

############ Определение пульсации выходного напряжения. ###############################################################################################################
#F/Результат;            Номер канала;    Напряжение СИ от U_max, В;                            Ток нагрузки от Imax, А;        Интервал жидания, с;        
Function PVDC_SER           mem_3            mem_2001                                            mem_3999                    mem_69                
# Установка выходного напряжения источника    
    DriverSet    LOAD_MODEL             Load = Off
    math mem_2100 = mem_2001 * U_max*2
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного тока источника    
    math mem_3100 = I_max                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                    # для удаленно управляемого источника
    else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равный mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
    math mem_3998 = mem_3999 * I_max
    call TOK_NAGRUZKI
    DriverSet    LOAD_MODEL             Load = On

# Считывание значения пульсаций в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  PULS_METER mem_2011 = READ                                #    Считать показания мультиметра (ток)
    DriverSet LOAD_MODEL Load = Off                                        #    Выключение нагрузки
# Расчет допустимой погрешности
    math mem_2010 = VDCpuls_coe * mem_2100 + VDCpuls_con                #    Допустимое отклонение для точки
    math mem_2011 = rand(mem_2010)
    math mem_2110 = mem_2010 * 1000                                      #    Перевод в миливольты
    string mem_6666=GetField(mem_2110;".";1)
    string mem_7777=GetField(mem_2110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_2110= mem_6666||","||mem_7777
    string mem_2110 = &'00B1' mem_2110                                      #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_2109 mem_2011<=mem_2010 description="ПУЛЬСАЦИИ НЕ В ДОПУСКЕ!"     #    Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, В;        Ток нагрузки, В;        Пульсации нагрузки, В;    Допуск;    Вывод о соответствии;
report PVDC_MANY_CH        mem_3        mem_2100                    mem_3998                mem_2011                    mem_2110        mem_2109
EndFunction

############ Определение абсолютной погрешности формирования силы выходного тока. ######################################################################################
#F/Результат;        Номер канала;        Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    
Function IDC_SER           mem_3            mem_3001                mem_2001                            mem_3999                    mem_69                            
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max                                     #    Поверяемая точка
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А  \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения
    math mem_3010 = IDC_coe * mem_3100 + IDC_con                #    Допустимое отклонение для точки    
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                     #    Добавление знака "+/-" для отчета
    math mem_3011 = mem_3101-mem_3100                                     #    Вычисления модуля отклонения для точки
# Сравнение и вывод
    math mem_3019 = abs(mem_3011)
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                 Номер канала;    Поверяемая точка, А;    Показание источника, А;        Погрешность;    Допуск;        Вывод о соответствии;
report IDC_MANY_CH      mem_3                mem_3100                mem_3101                    mem_3011        mem_3110        mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении напряжения питающей сети. ######################################################################### 
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;     Ток нагрузки от Imax, А;        Интервал жидания, с;    Напряжение питания от U_pit, В;        
Function INSTB_I_Upit_SER        mem_3            mem_3001                mem_2001                    mem_3999                    mem_69                        mem_2140                             
# Установка входного напряжения источника
    DriverSet POWER_SUPPLY V = U_pit
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * U_max*2
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * I_max
    call TOK_NAGRUZKI_SER
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max                                     
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                # для удаленно управляемого источника
    else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в опорной точке
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #     Считать показания мультиметра (ток)
# Плавная подстройка напряжения входного питания    
    call NASTROIKA_PITANIA
# Считывание значение тока при измененном напряжении входного питания    
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3102 = IDC                                #     Считать показания мультиметра (ток)
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCpit_coe * mem_3100 + IDCpit_con                    #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                     #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
    math mem_3011 = abs(mem_3102-mem_3101)                                     #    Вычисления модуля отклонения между точками
# Сравнение и вывод
    compare mem_3109 mem_3011<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Напряжение питания, В;    Поверяемая точка, А;    Измерение 1, В;    Измерение 2, В;    Нестабильность;    Допуск;    Вывод о соответствии;
report INSTB_I_Upit_MANY_CH        mem_3            mem_2141                    mem_3100            mem_3101            mem_3102            mem_3011        mem_3110            mem_3109
EndFunction

############ Определение нестабильности выходного тока при изменении выходного напряжения. #############################################################################
#F/Результат;                Номер канала;    Ток СИ от Imax, А;    Напряжение СИ от U_max, В;    Ток нагрузки от Imax, А;        Интервал жидания, с;    Выходное напряжение от U_max 2, В;
Function INSTB_I_Unagr_SER       mem_3        mem_3001                mem_2001                       mem_3999                    mem_69                        mem_2003                           
# Установка тока нагрузки    
    DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
    math mem_3998 = mem_3999 * I_max
    call TOK_NAGRUZKI_SER
# Установка выходного тока источника    
    math mem_3100 = mem_3001 * I_max                                    
    If Interface = true
        DriverSet Model_SI_Driver IDC = mem_3100                                                                    # для удаленно управляемого источника
        else
        Message mem_3100 checksyntax  defvalue=mem_3100 "Установите на источнике выходной ток равным mem_3100, А \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Установка выходного напряжения источника    
    DriverSet LOAD_MODEL Load = Off
    math mem_2100 = mem_2001 * U_max *2
    If Interface = true
        DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
        Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
    endif
# Считывание значения тока в точке с нагрузкой
    DriverSet LOAD_MODEL Load = On
    message wait=mem_69 "Ожидайте выполнения измерения"
    Driverget  CURRENT_METER mem_3101 = IDC                                #    Считать показания мультиметра с нагрузкой (ток)
        DriverSet LOAD_MODEL Load = Off
        if mem_2001 != mem_2003
        # Определение значения напряжения в нагрузке    
        math mem_2002 = U_max * mem_2003 * 2                                    #    Расчет значения напряжения в поверяемой точке
            If Interface = true
                DriverSet Model_SI_Driver VDC = mem_2002                                                                                       # для удаленно управляемого источника
            else
                Message mem_2002 checksyntax  defvalue=mem_2002 "Установите на источнике выходное напряжение равное mem_2002, В \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
            endif
        # Считывание значения тока в точке без нагрузки    
        DriverSet LOAD_MODEL Load = On
        message wait=mem_69 "Ожидайте выполнения измерения"
        Driverget  CURRENT_METER mem_3102 = IDC                                #    Считать показания мультиметра без нагрузки (ток)
        math mem_3011 = mem_3101-mem_3102                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)
        else
        math mem_3011 = mem_3101-mem_3100                                 #    Вычисления модуля отклонения между точками
        math mem_3019 = abs(mem_3011)                                    #    Вычисления модуля отклонения между точками
        string mem_3102 = "не измерялось в соотв. с методикой"
        endif
# Расчет допустимой погрешности и отклонения    
    math mem_3010 = IDCnagr_coe * mem_3100 + IDCnagr_con                #    Допустимое отклонение для точки
    math mem_3110 = mem_3010 * 1000                                       #    Перевод в милиамперы
    string mem_6666=GetField(mem_3110;".";1)
    string mem_7777=GetField(mem_3110;".";2)
        if mem_7777 = Nan
        math mem_7777 = 0
        endif
    string mem_3110= mem_6666||","||mem_7777
    string mem_3110 = &'00B1' mem_3110                                    #    Добавление знака "+/-" для отчета
# Сравнение и вывод
    compare mem_3109 mem_3019<=mem_3010 description="ОТКЛОНЕНИЕ НЕ В ДОПУСКЕ!"    #     Определение нахождения значения в дропуске
# в отчет                         Номер канала;    Значение тока в точке, А;    Показание источника с нагрузкой, А;    Напряжение в нагрузке, В;    Показание источника без нагрузки, А;    Нестабильность, А;    Допуск, А;    Вывод о соответствии;
report INSTB_I_Unagr_MANY_CH        mem_3            mem_3100                    mem_3101                                    mem_2100                        mem_3102                                mem_3011            mem_3110    mem_3109
EndFunction

#########################################################################################################################################################################
#######   I   N   T   E   R   R   U   P   T   ##########################################################################################################################
#########################################################################################################################################################################

###################################################################################################################################################################
######## КАНАЛ 1 ####################################################################################################################################################
###################################################################################################################################################################

#########################################################################################################################################################################
#############        Начальные установки для определения основной погрешности установки выходного напряжения постоянного тока        #####################################

Interrupt before VDC_CH1  first_in_script
        message "Подключите КАНАЛ mem_3 поверяемого источника питания для выполнения процедуры поверки в автоматическом режиме"
    # Установка тока нагрузки    
        if mem_3999 = 0
            DriverSet    LOAD_MODEL Load = Off
            math mem_3998 = mem_3999
        Else
            DriverSet    LOAD_MODEL Load = On                                    #    Включение нагрузки
            math mem_3998 = mem_3999 * I_max
            call TOK_NAGRUZKI
        Endif
    # Установка выходного тока источника    
        math mem_3100 = mem_3001 * I_max
        If Interface = true
            DriverSet Model_SI_Driver Channel = mem_3                                                                                        # для удаленно управляемого источника
            DriverSet Model_SI_Driver IDC = mem_3100                                                                                    # для удаленно управляемого источника
        else
            message "На поверяемом источнике установите регулятором выходного тока максимальное значение, канал mem_3"        # для источника без интерфейса
        endif
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении напряжения питания        #################################

Interrupt before INSTB_U_Upit_CH1 first_in_script
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
    #Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * I_max
        call TOK_NAGRUZKI
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении тока нагрузки        #################################

Interrupt before INSTB_U_Inagr_CH1 first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения пульсаций выходного напряжения ########################################################

Interrupt before PVDC_CH1 first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
        
        DriverSet PULS_METER   RESET
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения основной погрешности установки выходного тока ########################################################

Interrupt before IDC_CH1 first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
    # Установка выходного напряжения источника    
        DriverSet LOAD_MODEL Load = Off
        math mem_2100 = mem_2001 * U_max
        If Interface = true
            DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
            Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В, канал mem_3 \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
        endif
    # Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * I_max
        call TOK_NAGRUZKI
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения питания        #################################

Interrupt before INSTB_I_Upit_CH1 first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения нагрузки        #################################

Interrupt before INSTB_I_Unagr_CH1 first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

#########################################################################################################################################################################
####################################		Начальные установки для определения пульсаций выходного тока ########################################################

Interrupt before PIDC_CH1 first_in_script
	# Перевод нагрузки в режим СC
		DriverSet LOAD_MODEL MODE = CC
	# Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
		DriverSet POWER_SUPPLY V = U_pit
	# Установка диапазона для амперметра
		If I_max <= 30
			DriverSet CURRENT_METER Range_IDC = 30							#	установка предела измерений амперметра 30А
		Else
			DriverSet CURRENT_METER Range_IDC = 300							#	установка предела измерений амперметра 300А
		Endif

		DriverSet PULS_METER   RESET
	# Установка тока нагрузки	
		DriverSet LOAD_MODEL Load = On										#	Включение нагрузки
		math mem_3998 = mem_3999 * I_max
		call TOK_NAGRUZKI
	# Установка выходного тока источника	
		math mem_3100 = mem_3001 * I_max									
		If Interface = true
			DriverSet Model_SI_Driver IDC = mem_3100    												# для удаленно управляемого источника
			else
			message "На поверяемом источнике установите регулятором выходного тока значение mem_3100 А, канал 1"	# для источника без интерфейса
		endif
EndInterrupt

###################################################################################################################################################################
######## КАНАЛ 2 ####################################################################################################################################################
###################################################################################################################################################################

#########################################################################################################################################################################
#############        Начальные установки для определения основной погрешности установки выходного напряжения постоянного тока        #####################################

Interrupt before VDC_CH2  first_in_script
        message "Подключите КАНАЛ mem_3 поверяемого источника питания для выполнения процедуры поверки в автоматическом режиме"
    # Установка тока нагрузки    
        if mem_3999 = 0
            DriverSet    LOAD_MODEL Load = Off
            math mem_3998 = mem_3999
        Else
            DriverSet    LOAD_MODEL Load = On                                    #    Включение нагрузки
            math mem_3998 = mem_3999 * I_max
            call TOK_NAGRUZKI
        Endif
    # Установка выходного тока источника    
        math mem_3100 = mem_3001 * I_max
        If Interface = true
            DriverSet Model_SI_Driver Channel = mem_3                                                                                    # для удаленно управляемого источника
            DriverSet Model_SI_Driver IDC = mem_3100                                                                                    # для удаленно управляемого источника
        else
            message "На поверяемом источнике установите регулятором выходного тока максимальное значение, канал mem_3"        # для источника без интерфейса
        endif
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении напряжения питания        #################################

Interrupt before INSTB_U_Upit_CH2 first_in_script
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
    #Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * I_max
        call TOK_NAGRUZKI
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении тока нагрузки        #################################

Interrupt before INSTB_U_Inagr_CH2 first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения пульсаций выходного напряжения ########################################################

Interrupt before PVDC_CH2 first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
        
        DriverSet PULS_METER   RESET
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения основной погрешности установки выходного тока ########################################################

Interrupt before IDC_CH2 first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
    # Установка выходного напряжения источника    
        DriverSet LOAD_MODEL Load = Off
        math mem_2100 = mem_2001 * U_max
        If Interface = true
            DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
            Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В, канал mem_3 \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
        endif
    # Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * I_max
        call TOK_NAGRUZKI
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения питания        #################################

Interrupt before INSTB_I_Upit_CH2 first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения нагрузки        #################################

Interrupt before INSTB_I_Unagr_CH2 first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

#########################################################################################################################################################################
####################################		Начальные установки для определения пульсаций выходного тока ########################################################

Interrupt before PIDC_CH2 first_in_script
	# Перевод нагрузки в режим СC
		DriverSet LOAD_MODEL MODE = CC
	# Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
		DriverSet POWER_SUPPLY V = U_pit
	# Установка диапазона для амперметра
		If I_max <= 30
			DriverSet CURRENT_METER Range_IDC = 30							#	установка предела измерений амперметра 30А
		Else
			DriverSet CURRENT_METER Range_IDC = 300							#	установка предела измерений амперметра 300А
		Endif

		DriverSet PULS_METER   RESET
	# Установка тока нагрузки	
		DriverSet LOAD_MODEL Load = On										#	Включение нагрузки
		math mem_3998 = mem_3999 * I_max
		call TOK_NAGRUZKI
	# Установка выходного тока источника	
		math mem_3100 = mem_3001 * I_max									
		If Interface = true
			DriverSet Model_SI_Driver IDC = mem_3100    												# для удаленно управляемого источника
			else
			message "На поверяемом источнике установите регулятором выходного тока значение mem_3100 А, канал 2"	# для источника без интерфейса
		endif
EndInterrupt


###################################################################################################################################################################
######## КАНАЛ 3 ####################################################################################################################################################
###################################################################################################################################################################

#########################################################################################################################################################################
#############        Начальные установки для определения основной погрешности установки выходного напряжения постоянного тока        #####################################

Interrupt before VDC_CH3  first_in_script
        message "Подключите КАНАЛ mem_3 поверяемого источника питания для выполнения процедуры поверки в автоматическом режиме"
    # Установка тока нагрузки    
        if mem_3999 = 0
            DriverSet    LOAD_MODEL Load = Off
            math mem_3998 = mem_3999
        Else
            DriverSet    LOAD_MODEL Load = On                                    #    Включение нагрузки
            math mem_3998 = mem_3999 * Ich3_max
            call TOK_NAGRUZKI
        Endif
    # Установка выходного тока источника    
        math mem_3100 = mem_3001 * Ich3_max
        If Interface = true
            DriverSet Model_SI_Driver Channel = mem_3                                                                                    # для удаленно управляемого источника
            DriverSet Model_SI_Driver IDC = mem_3100                                                                                    # для удаленно управляемого источника
        else
            message "На поверяемом источнике установите регулятором выходного тока максимальное значение, канал mem_3"        # для источника без интерфейса
        endif
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении напряжения питания        #################################

Interrupt before INSTB_U_Upit_CH3 first_in_script
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
    #Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * Ich3_max
        call TOK_NAGRUZKI
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении тока нагрузки        #################################

Interrupt before INSTB_U_Inagr_CH3 first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения пульсаций выходного напряжения ########################################################

Interrupt before PVDC_CH3 first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
        
        DriverSet PULS_METER   RESET
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения основной погрешности установки выходного тока ########################################################

Interrupt before IDC_CH3 first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
    # Установка выходного напряжения источника    
        DriverSet LOAD_MODEL Load = Off
        math mem_2100 = mem_2001 * Uch3_max
        If Interface = true
            DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
            Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В, канал mem_3 \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
        endif
    # Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * Ich3_max
        call TOK_NAGRUZKI
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения питания        #################################

Interrupt before INSTB_I_Upit_CH3 first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения нагрузки        #################################

Interrupt before INSTB_I_Unagr_CH3 first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

###################################################################################################################################################################
######## Параллельное включение ####################################################################################################################################################
###################################################################################################################################################################

#########################################################################################################################################################################
#############        Начальные установки для определения основной погрешности установки выходного напряжения постоянного тока        #####################################

Interrupt before VDC_PAR  first_in_script
        message "Подключите каналы 1 и 2 поверяемого источника питания в параллельное включение для выполнения процедуры поверки в автоматическом режиме"
    # Установка тока нагрузки    
        if mem_3999 = 0
            DriverSet    LOAD_MODEL Load = Off
            math mem_3998 = mem_3999
        Else
            DriverSet    LOAD_MODEL Load = On                                    #    Включение нагрузки
            math mem_3998 = mem_3999 * I_max*2
            call TOK_NAGRUZKI_PAR
        Endif
    # Установка выходного тока источника    
        math mem_3100 = mem_3001 * I_max*2
        If Interface = true
            DriverSet Model_SI_Driver IDC = mem_3100                                                                                    # для удаленно управляемого источника
        else
            message "На поверяемом источнике установите регулятором выходного тока максимальное значение, параллельное включение"        # для источника без интерфейса
        endif
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении напряжения питания        #################################

Interrupt before INSTB_U_Upit_PAR first_in_script
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
    #Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * I_max*2
        call TOK_NAGRUZKI
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении тока нагрузки        #################################

Interrupt before INSTB_U_Inagr_PAR first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения пульсаций выходного напряжения ########################################################

Interrupt before PVDC_PAR first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
        
        DriverSet PULS_METER   RESET
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения основной погрешности установки выходного тока ########################################################

Interrupt before IDC_PAR first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If (I_max*2) <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
    # Установка выходного напряжения источника    
        DriverSet LOAD_MODEL Load = Off
        math mem_2100 = mem_2001 * U_max
        If Interface = true
            DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
            Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В, параллельное включение \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
        endif
    # Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * I_max*2
        call TOK_NAGRUZKI_PAR
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения питания        #################################

Interrupt before INSTB_I_Upit_PAR first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения нагрузки        #################################

Interrupt before INSTB_I_Unagr_PAR first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

###################################################################################################################################################################
######## Последовательное включение ####################################################################################################################################################
###################################################################################################################################################################

#########################################################################################################################################################################
#############        Начальные установки для определения основной погрешности установки выходного напряжения постоянного тока        #####################################

Interrupt before VDC_SER  first_in_script
        message "Подключите каналы 1 и 2 поверяемого источника питания в последовательное включение для выполнения процедуры поверки в автоматическом режиме"
    # Установка тока нагрузки    
        if mem_3999 = 0
            DriverSet    LOAD_MODEL Load = Off
            math mem_3998 = mem_3999
        Else
            DriverSet    LOAD_MODEL Load = On                                    #    Включение нагрузки
            math mem_3998 = mem_3999 * I_max
            call TOK_NAGRUZKI_SER
        Endif
    # Установка выходного тока источника    
        math mem_3100 = mem_3001 * I_max
        If Interface = true
            DriverSet Model_SI_Driver Channel = mem_3                                                                                        # для удаленно управляемого источника
            DriverSet Model_SI_Driver IDC = mem_3100                                                                                    # для удаленно управляемого источника
        else
            message "На поверяемом источнике установите регулятором выходного тока максимальное значение, последовательное включение"        # для источника без интерфейса
        endif
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении напряжения питания        #################################

Interrupt before INSTB_U_Upit_SER first_in_script
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
    #Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * I_max
        call TOK_NAGRUZKI_SER
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного напряжения при изменении тока нагрузки        #################################

Interrupt before INSTB_U_Inagr_SER first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения пульсаций выходного напряжения ########################################################

Interrupt before PVDC_SER first_in_script
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    #Перевод вольтметра в режим VDC
        DriverSet VOLTAGE_METER RESET
        DriverSet VOLTAGE_METER Func = VDC
        
        DriverSet PULS_METER   RESET
EndInterrupt

#########################################################################################################################################################################
####################################        Начальные установки для определения основной погрешности установки выходного тока ########################################################

Interrupt before IDC_SER first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
    # Установка выходного напряжения источника    
        DriverSet LOAD_MODEL Load = Off
        math mem_2100 = mem_2001 * U_max *2
        If Interface = true
            DriverSet Model_SI_Driver VDC = mem_2100                                                                                       # для удаленно управляемого источника
        else
            Message mem_2100 checksyntax  defvalue=mem_2100 "Установите на источнике выходное напряжение равное mem_2100, В, последовательное включение \n если это не удается, введите наиболее близкое значение, которое можете установить"        # для источника без интерфейса
        endif
    # Установка тока нагрузки    
        DriverSet LOAD_MODEL Load = On                                        #    Включение нагрузки
        math mem_3998 = mem_3999 * I_max
        call TOK_NAGRUZKI_SER
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения питания        #################################

Interrupt before INSTB_I_Upit_SER first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

#########################################################################################################################################################################
#############        Начальные установки для определения основной нестабильности выходного тока при изменении напряжения нагрузки        #################################

Interrupt before INSTB_I_Unagr_SER first_in_script
    # Перевод нагрузки в режим СC
        DriverSet LOAD_MODEL MODE = CC
    # Установить на источнике переменного напряжения значение стандартного напряжения питания (на случай ранее проведенных изменений)
        DriverSet POWER_SUPPLY V = U_pit
    # Установка диапазона для амперметра
        If I_max <= 30
            DriverSet CURRENT_METER Range_IDC = 30                            #    установка предела измерений амперметра 30А
        Else
            DriverSet CURRENT_METER Range_IDC = 300                            #    установка предела измерений амперметра 300А
        Endif
EndInterrupt

#######################################################################################################################################################################################
##########   M   E   M   ###########################################################################################################################################################
#######################################################################################################################################################################################

#mem_1xxx - данные для заполнения таблиц по условиям проведения поверки + номера пунктов "Внешнего осмотра" и "Опробования"
#mem_2xxx - данные для заполнения таблиц по напряжению
#mem_3xxx - данные для заполнения таблиц по току
#mem_4xxx - данные для заполнения таблиц по сопротивлению
#mem_х1xx - данные для заполнения таблиц в отчет
